// From campaign, make it a server-side version
untyped
global function MP_BossTitan_Conversation_Init

// settings
global function MpBossTitan_SetTitanConversationStyle
// conversation currently no support for new added titan. let them use existing ones
global function MpBossTitan_SetConversationNameOverride

// main utility
global function MpBossTitan_PlayConversationDefault // based on titan's conversation style
global function MpBossTitan_PlayConversationToTarget // play conversation to current target(eBossTitanConvStyle.PLAY_TO_TARGET)
global function MpBossTitan_PlayConversationToAll // play conversation to all players(eBossTitanConvStyle.PLAY_TO_ALL)

global function MpBossTitan_TryPlayConversationToPlayer

// random conversation
global function MpBossTitan_StartTitanRandomLines
global function MpBossTitan_StopTitanRandomLines

// intro conversations
global function MpBossTitan_ConversationPostIntro
global function MpBossTitan_ConversationNoIntro

// player damage boss conversations
global function MpBossTitan_ConversationDamaged
global function MpBossTitan_ConversationLostSegment
global function MpBossTitan_ConversationDoomed
global function MpBossTitan_ConversationDeath
// boss ability react conversations
global function MpBossTitan_SetTitanEnableCoreConversation // settings
global function MpBossTitan_ConversationUseCoreAbility
global function MpBossTitan_ConversationRetreat
global function MpBossTitan_ConversationAdvance

// boss damage player conversations
global function MpBossTitan_ConversationTookPlayerSegment
// boss react player ability conversations
global function MpBossTitan_ConversationPlayerUseCoreAbility

// dialogue handlers
global function MpBossTitan_CancelBossConversation
global function MpBossTitan_DelayNextBossRandomLine

const float BOSS_TITAN_LINE_TIMEOUT = 10.0

// debug
const bool BOSS_TITAN_LINE_DEBUG_PRINT = false

global enum eBossTitanConvStyle
{
    PLAY_TO_TARGET, // default
    PLAY_TO_ALL,
    DISABLED
}

struct MpBossTitanLine
{
	int conversationStyle = eBossTitanConvStyle.PLAY_TO_TARGET
	string lastPlayedSoundAlias = ""
	bool enableCoreConversation = true
}

struct MpBossTitanLineReceiver // player struct
{
	string lastPlayedSoundAlias = ""
	entity lastSpeakerTitan = null
}


// from sh_ai_boss_titan.gnut
// use array<string> is enough for mp
/*
struct BossTitanConversation
{
	array<string> soundAliases
	// shouldn't include for mp
	//array<string> usedAliases
	//int eventPriority
	//string eventVisualStyle
	//asset customVideo
}
*/

struct
{
	// conversation currently no support for new added titan. let them use existing ones
	table<entity, string> conversationTitanNameOverride

    table<entity, MpBossTitanLine> mpBossTitanConversation
	table<entity, MpBossTitanLineReceiver> mpBossTitanLineReceiver // player struct

    // from sh_ai_boss_titan.gnut, adding support per player
    table< string, table< string, array<string> > > bossTitanConvData // use array<string> is enough
	table< entity, table<string, float> > aliasUsedTimesOnPlayer

    // from cl_ai_boss_titan.gnut, adding support per player or per boss
    table<entity, float> bossNextRandomLineTime
	table< entity, float > lastSaidLineTimeOnPlayer // handling last said line
    table< entity, table<string, float> > lastSaidLineTimesOnPlayer // handling multiple lines

	// from struct, needs to move out to specific for player
	table< entity, array<string> > usedAliasesOnPlayer
} file

void function MP_BossTitan_Conversation_Init()
{
	#if !BOSS_TITAN_LINE_DEBUG_PRINT // debug should always init
		if ( IsLobby() )
			return
	#endif

	// initialize data(needs modded rpak)
	InitBossTitanConversationData()

	// signals from sh_ai_boss_titan
	RegisterSignal( "CancelBossConversation" )

	RegisterSignal( "StopBossTitanRandomLines" )

    AddCallback_OnClientConnected( OnClientConnected )

	AddCallback_OnMpBossTitanRegister( OnBossTitanRegister )
	AddCallback_OnMpBosstitanDeregister( OnBossTitanDeregister )
}



//  ___ _   _ ___ _____ ___    _    _     ___ __________     ____    _  _____  _    
// |_ _| \ | |_ _|_   _|_ _|  / \  | |   |_ _|__  / ____|   |  _ \  / \|_   _|/ \   
//  | ||  \| || |  | |  | |  / _ \ | |    | |  / /|  _|     | | | |/ _ \ | | / _ \  
//  | || |\  || |  | |  | | / ___ \| |___ | | / /_| |___    | |_| / ___ \| |/ ___ \ 
// |___|_| \_|___| |_| |___/_/   \_\_____|___/____|_____|   |____/_/   \_\_/_/   \_\

// initialize data(needs modded rpak)
void function InitBossTitanConversationData()
{
	// fill boss fields
    // I can't handle datatable importing, let's just fill it by hand
    /*
	var dataTable = GetDataTable( $"datatable/titan_boss_lines.rpak" )
	for ( int i = 0; i < GetDatatableRowCount( dataTable ); i++ )
	{
		string bossName	= GetDataTableString( dataTable, i, GetDataTableColumnByName( dataTable, "characterName" ) )
		string eventName = GetDataTableString( dataTable, i, GetDataTableColumnByName( dataTable, "event" ) )

		if (!( bossName in file.bossTitanConvData ) )
			file.bossTitanConvData[ bossName ] <- {}

		if (!( eventName in file.bossTitanConvData[ bossName ] ))
		{
			BossTitanConversation data
			// shouldn't include for mp
			// data.eventPriority = GetDataTableInt( dataTable, i, GetDataTableColumnByName( dataTable, "priority" ) )
			// data.eventVisualStyle = GetDataTableString( dataTable, i, GetDataTableColumnByName( dataTable, "visualStyle" ) )
			// if ( data.eventVisualStyle == "vdu_custom" )
			// {
			// 	data.customVideo = GetDataTableAsset( dataTable, i, GetDataTableColumnByName( dataTable, "customVideo" ) )
			// 	PrecacheMaterial( data.customVideo )
			// }

			file.bossTitanConvData[ bossName ][ eventName ] <- data
		}

		string soundAlias = GetDataTableString( dataTable, i, GetDataTableColumnByName( dataTable, "audio" ) )
		file.bossTitanConvData[ bossName ][ eventName ].soundAliases.append( soundAlias )
	}
	*/

	// only one issue left: init data will make all dialogues belong to a single struct

	// remove struct. using array<string> is enough for mp
	//table<string, BossTitanConversation> emptyTable
	//BossTitanConversation emptyData
	//BossTitanConversation currentData
	table< string, array<string> > emptyTable
	array<string> emptyData
	array<string> currentData

	///////////
	/// Ash ///
	///////////
	file.bossTitanConvData[ "Ash" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Ash" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_doomed" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_playerUsedCoreAbility" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_coreAbility" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_random" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_playerUsedCoreAbility_boss1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_tookPlayerSegment_boss1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_coreAbility_boss1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_random_boss1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_coreAbility_backup" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_retreat" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_advance" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_tookPlayerSegment_backup" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_playerUsedCoreAbility_backup" ] <- clone emptyData
	file.bossTitanConvData[ "Ash" ][ "bossTitan_random_backup" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_post_intro" ]
	#if BOSS_TITAN_LINE_DEBUG_PRINT
		print( "currentData print: " + string( currentData ) )
	#endif
	currentData.append( "diag_sp_BossVdu_BM112_02_01_imc_ash" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_2segmentsLeft" ]
	#if BOSS_TITAN_LINE_DEBUG_PRINT
		print( "currentData print: " + string( currentData ) )
	#endif
	currentData.append( "diag_sp_BossVdu_BM112_03_01_imc_ash" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_sp_BossVdu_BM112_04_01_imc_ash" )
	// doomed
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_doomed" ]
	currentData.append( "diag_sp_BossVdu_BM112_05_01_imc_ash" )
	// death
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_death" ]
	currentData.append( "diag_sp_BossVdu_BM111_06_01_imc_ash" )
	// playerUsedCoreAbility
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_playerUsedCoreAbility" ]
	currentData.append( "diag_sp_BossVdu_BM112_07_01_imc_ash" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_sp_BossVdu_BM112_08_01_imc_ash" )
	// coreAbility
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_coreAbility" ]
	currentData.append( "diag_sp_BossVdu_BM112_09_01_imc_ash" )
	// random
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_random" ]
	currentData.append( "diag_sp_BossVdu_BM112_10_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_11_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_12_01_imc_ash" )
	// playerUsedCoreAbility_boss1segmentLeft
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_playerUsedCoreAbility_boss1segmentLeft" ]
	currentData.append( "diag_sp_BossVdu_BM112_13_01_imc_ash" )
	// tookPlayerSegment_boss1segmentLeft
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_tookPlayerSegment_boss1segmentLeft" ]
	currentData.append( "diag_sp_BossVdu_BM112_14_01_imc_ash" )
	// coreAbility_boss1segmentLeft
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_coreAbility_boss1segmentLeft" ]
	currentData.append( "diag_sp_BossVdu_BM112_15_01_imc_ash" )
	// random_boss1segmentLeft
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_random_boss1segmentLeft" ]
	currentData.append( "diag_sp_BossVdu_BM112_16_01_imc_ash" )
	// coreAbility_backup
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_coreAbility_backup" ]
	currentData.append( "diag_sp_BossVdu_BM112_17_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_18_01_imc_ash" )
	// retreat
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_retreat" ]
	currentData.append( "diag_sp_BossVdu_BM112_19_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_20_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_21_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_22_01_imc_ash" )
	// advance
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_advance" ]
	currentData.append( "diag_sp_BossVdu_BM112_23_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_24_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_25_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_26_01_imc_ash" )
	// tookPlayerSegment_backup
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_tookPlayerSegment_backup" ]
	currentData.append( "diag_sp_BossVdu_BM112_27_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_28_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_29_01_imc_ash" )
	// playerUsedCoreAbility_backup
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_playerUsedCoreAbility_backup" ]
	currentData.append( "diag_sp_BossVdu_BM112_30_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_31_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_32_01_imc_ash" )
	// random_backup
	currentData = file.bossTitanConvData[ "Ash" ][ "bossTitan_random_backup" ]
	currentData.append( "diag_sp_BossVdu_BM112_33_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_34_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_35_01_imc_ash" )
	currentData.append( "diag_sp_BossVdu_BM112_36_01_imc_ash" )

	/////////////
	/// Viper ///
	/////////////
	file.bossTitanConvData[ "Viper" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Viper" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_doomed" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_playerUsedCoreAbility" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_coreAbility" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_random" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_playerUsedCoreAbility_boss1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_tookPlayerSegment_boss1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_coreAbility_boss1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_random_boss1segmentLeft" ] <- clone emptyData
	// viper don't have coreAbility_backup
	file.bossTitanConvData[ "Viper" ][ "bossTitan_retreat" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_advance" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_tookPlayerSegment_backup" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_playerUsedCoreAbility_backup" ] <- clone emptyData
	file.bossTitanConvData[ "Viper" ][ "bossTitan_random_backup" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_sp_bossFight_STS676_03_01_imc_viper" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_sp_bossFight_STS676_04_01_imc_viper" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_sp_bossFight_STS676_05_01_imc_viper" )
	// doomed
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_doomed" ]
	currentData.append( "diag_sp_bossFight_STS676_42_01_imc_viper" )
	// death
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_death" ]
	currentData.append( "diag_sp_bossFight_STS676_43_01_imc_viper" )
	// playerUsedCoreAbility
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_playerUsedCoreAbility" ]
	currentData.append( "diag_sp_bossFight_STS676_06_01_imc_viper" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_sp_bossFight_STS676_07_01_imc_viper" )
	// coreAbility
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_coreAbility" ]
	currentData.append( "diag_sp_bossFight_STS676_08_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_39_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_15_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_09_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_11_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_40_01_imc_viper" )
	// random
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_random" ]
	currentData.append( "diag_sp_bossFight_STS676_10_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_19_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_10_01_imc_viper" )
	// playerUsedCoreAbility_boss1segmentLeft
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_playerUsedCoreAbility_boss1segmentLeft" ]
	currentData.append( "diag_sp_bossFight_STS676_12_01_imc_viper" )
	// tookPlayerSegment_boss1segmentLeft
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_tookPlayerSegment_boss1segmentLeft" ]
	currentData.append( "diag_sp_bossFight_STS676_13_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_14_01_imc_viper" )
	// coreAbility_boss1segmentLeft
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_coreAbility_boss1segmentLeft" ]
	currentData.append( "diag_sp_bossFight_STS676_09_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_11_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_40_01_imc_viper" )
	// random_boss1segmentLeft
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_random_boss1segmentLeft" ]
	currentData.append( "diag_sp_bossFight_STS676_16_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_17_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_18_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_19_01_imc_viper" )
	// viper don't have coreAbility_backup
	// retreat
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_retreat" ]
	currentData.append( "diag_sp_bossFight_STS676_20_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_21_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_22_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_23_01_imc_viper" )
	// advance
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_advance" ]
	currentData.append( "diag_sp_bossFight_STS676_24_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_25_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_26_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_27_01_imc_viper" )
	// tookPlayerSegment_backup
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_tookPlayerSegment_backup" ]
	currentData.append( "diag_sp_bossFight_STS676_28_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_32_01_imc_viper" )
	// playerUsedCoreAbility_backup
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_playerUsedCoreAbility_backup" ]
	currentData.append( "diag_sp_bossFight_STS676_29_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_30_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_31_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_36_01_imc_viper" )
	// random_backup
	currentData = file.bossTitanConvData[ "Viper" ][ "bossTitan_random_backup" ]
	currentData.append( "diag_sp_bossFight_STS676_33_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_41_01_imc_viper" )
	currentData.append( "diag_sp_bossFight_STS676_35_01_imc_viper" )

	////////////////
	/// Generic1 ///
	////////////////
	file.bossTitanConvData[ "Generic1" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_6segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_5segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_4segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_3segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ] <- clone emptyData
	file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_imc_pilot1_hc_battleStart" )
	// 6segmentsLeft
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_6segmentsLeft" ]
	currentData.append( "diag_imc_pilot1_hc_lostChicket56" )
	// 5segmentsLeft
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_5segmentsLeft" ]
	currentData.append( "diag_imc_pilot1_hc_lostChicket56" )
	// 4segmentsLeft
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_4segmentsLeft" ]
	currentData.append( "diag_imc_pilot1_hc_lostChicket34" )
	// 3segmentsLeft
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_3segmentsLeft" ]
	currentData.append( "diag_imc_pilot1_hc_lostChicket34" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_imc_pilot1_hc_lostChicket2" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_imc_pilot1_hc_lostChicket1" )
	// death
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_death" ]
	currentData.append( "diag_imc_pilot1_hc_death" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_imc_pilot1_hc_plyrLostChicklet" )
	// coreAbility_mp_titancore_shift_core
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ]
	currentData.append( "diag_imc_pilot1_hc_coreSwordActivate" )
	// coreAbility_mp_titancore_flight_core
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ]
	currentData.append( "diag_imc_pilot1_hc_coreFlightActivate" )
	// coreAbility_mp_titancore_laser_cannon
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ]
	currentData.append( "diag_imc_pilot1_hc_coreLaserActivate" )
	// coreAbility_mp_titancore_flame_wave
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ]
	currentData.append( "diag_imc_pilot1_hc_coreFlameActivate" )
	// coreAbility_mp_titancore_siege_mode
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ]
	currentData.append( "diag_imc_pilot1_hc_coreSmartActivate" )
	// coreAbility_mp_titancore_salvo_core
	currentData = file.bossTitanConvData[ "Generic1" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ]
	currentData.append( "diag_imc_pilot1_hc_coreRocketActivate" )

	////////////////
	/// Generic2 ///
	////////////////
	file.bossTitanConvData[ "Generic2" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_6segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_5segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_4segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_3segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ] <- clone emptyData
	file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_imc_pilot2_hc_battleStart" )
	// 6segmentsLeft
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_6segmentsLeft" ]
	currentData.append( "diag_imc_pilot2_hc_lostChicket56" )
	// 5segmentsLeft
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_5segmentsLeft" ]
	currentData.append( "diag_imc_pilot2_hc_lostChicket56" )
	// 4segmentsLeft
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_4segmentsLeft" ]
	currentData.append( "diag_imc_pilot2_hc_lostChicket34" )
	// 3segmentsLeft
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_3segmentsLeft" ]
	currentData.append( "diag_imc_pilot2_hc_lostChicket34" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_imc_pilot2_hc_lostChicket2" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_imc_pilot2_hc_lostChicket1" )
	// death
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_death" ]
	currentData.append( "diag_imc_pilot2_hc_death" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_imc_pilot2_hc_plyrLostChicklet" )
	// coreAbility_mp_titancore_shift_core
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ]
	currentData.append( "diag_imc_pilot2_hc_coreSwordActivate" )
	// coreAbility_mp_titancore_flight_core
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ]
	currentData.append( "diag_imc_pilot2_hc_coreFlightActivate" )
	// coreAbility_mp_titancore_laser_cannon
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ]
	currentData.append( "diag_imc_pilot2_hc_coreLaserActivate" )
	// coreAbility_mp_titancore_flame_wave
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ]
	currentData.append( "diag_imc_pilot2_hc_coreFlameActivate" )
	// coreAbility_mp_titancore_siege_mode
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ]
	currentData.append( "diag_imc_pilot2_hc_coreSmartActivate" )
	// coreAbility_mp_titancore_salvo_core
	currentData = file.bossTitanConvData[ "Generic2" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ]
	currentData.append( "diag_imc_pilot2_hc_coreRocketActivate" )

	////////////////
	/// Generic3 ///
	////////////////
	file.bossTitanConvData[ "Generic3" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_6segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_5segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_4segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_3segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ] <- clone emptyData
	file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_imc_pilot3_hc_battleStart" )
	// 6segmentsLeft
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_6segmentsLeft" ]
	currentData.append( "diag_imc_pilot3_hc_lostChicket56" )
	// 5segmentsLeft
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_5segmentsLeft" ]
	currentData.append( "diag_imc_pilot3_hc_lostChicket56" )
	// 4segmentsLeft
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_4segmentsLeft" ]
	currentData.append( "diag_imc_pilot3_hc_lostChicket34" )
	// 3segmentsLeft
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_3segmentsLeft" ]
	currentData.append( "diag_imc_pilot3_hc_lostChicket34" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_imc_pilot3_hc_lostChicket2" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_imc_pilot3_hc_lostChicket1" )
	// death
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_death" ]
	currentData.append( "diag_imc_pilot3_hc_death" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_imc_pilot3_hc_plyrLostChicklet" )
	// coreAbility_mp_titancore_shift_core
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ]
	currentData.append( "diag_imc_pilot3_hc_coreSwordActivate" )
	// coreAbility_mp_titancore_flight_core
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ]
	currentData.append( "diag_imc_pilot3_hc_coreFlightActivate" )
	// coreAbility_mp_titancore_laser_cannon
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ]
	currentData.append( "diag_imc_pilot3_hc_coreLaserActivate" )
	// coreAbility_mp_titancore_flame_wave
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ]
	currentData.append( "diag_imc_pilot3_hc_coreFlameActivate" )
	// coreAbility_mp_titancore_siege_mode
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ]
	currentData.append( "diag_imc_pilot3_hc_coreSmartActivate" )
	// coreAbility_mp_titancore_salvo_core
	currentData = file.bossTitanConvData[ "Generic3" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ]
	currentData.append( "diag_imc_pilot3_hc_coreRocketActivate" )

	////////////////
	/// Generic4 ///
	////////////////
	file.bossTitanConvData[ "Generic4" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_6segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_5segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_4segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_3segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ] <- clone emptyData
	file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_imc_pilot4_hc_battleStart" )
	// 6segmentsLeft
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_6segmentsLeft" ]
	currentData.append( "diag_imc_pilot4_hc_lostChicket56" )
	// 5segmentsLeft
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_5segmentsLeft" ]
	currentData.append( "diag_imc_pilot4_hc_lostChicket56" )
	// 4segmentsLeft
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_4segmentsLeft" ]
	currentData.append( "diag_imc_pilot4_hc_lostChicket34" )
	// 3segmentsLeft
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_3segmentsLeft" ]
	currentData.append( "diag_imc_pilot4_hc_lostChicket34" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_imc_pilot4_hc_lostChicket2" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_imc_pilot4_hc_lostChicket1" )
	// death
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_death" ]
	currentData.append( "diag_imc_pilot4_hc_death" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_imc_pilot4_hc_plyrLostChicklet" )
	// coreAbility_mp_titancore_shift_core
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ]
	currentData.append( "diag_imc_pilot4_hc_coreSwordActivate" )
	// coreAbility_mp_titancore_flight_core
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ]
	currentData.append( "diag_imc_pilot4_hc_coreFlightActivate" )
	// coreAbility_mp_titancore_laser_cannon
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ]
	currentData.append( "diag_imc_pilot4_hc_coreLaserActivate" )
	// coreAbility_mp_titancore_flame_wave
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ]
	currentData.append( "diag_imc_pilot4_hc_coreFlameActivate" )
	// coreAbility_mp_titancore_siege_mode
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ]
	currentData.append( "diag_imc_pilot4_hc_coreSmartActivate" )
	// coreAbility_mp_titancore_salvo_core
	currentData = file.bossTitanConvData[ "Generic4" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ]
	currentData.append( "diag_imc_pilot4_hc_coreRocketActivate" )

	////////////////
	/// Generic5 ///
	////////////////
	file.bossTitanConvData[ "Generic5" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_6segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_5segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_4segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_3segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ] <- clone emptyData
	file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_imc_pilot5_hc_battleStart" )
	// 6segmentsLeft
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_6segmentsLeft" ]
	currentData.append( "diag_imc_pilot5_hc_lostChicket56" )
	// 5segmentsLeft
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_5segmentsLeft" ]
	currentData.append( "diag_imc_pilot5_hc_lostChicket56" )
	// 4segmentsLeft
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_4segmentsLeft" ]
	currentData.append( "diag_imc_pilot5_hc_lostChicket34" )
	// 3segmentsLeft
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_3segmentsLeft" ]
	currentData.append( "diag_imc_pilot5_hc_lostChicket34" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_imc_pilot5_hc_lostChicket2" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_imc_pilot5_hc_lostChicket1" )
	// death
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_death" ]
	currentData.append( "diag_imc_pilot5_hc_death" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_imc_pilot5_hc_plyrLostChicklet" )
	// coreAbility_mp_titancore_shift_core
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ]
	currentData.append( "diag_imc_pilot5_hc_coreSwordActivate" )
	// coreAbility_mp_titancore_flight_core
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ]
	currentData.append( "diag_imc_pilot5_hc_coreFlightActivate" )
	// coreAbility_mp_titancore_laser_cannon
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ]
	currentData.append( "diag_imc_pilot5_hc_coreLaserActivate" )
	// coreAbility_mp_titancore_flame_wave
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ]
	currentData.append( "diag_imc_pilot5_hc_coreFlameActivate" )
	// coreAbility_mp_titancore_siege_mode
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ]
	currentData.append( "diag_imc_pilot5_hc_coreSmartActivate" )
	// coreAbility_mp_titancore_salvo_core
	currentData = file.bossTitanConvData[ "Generic5" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ]
	currentData.append( "diag_imc_pilot5_hc_coreRocketActivate" )

	////////////////
	/// Generic6 ///
	////////////////
	file.bossTitanConvData[ "Generic6" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_6segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_5segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_4segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_3segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ] <- clone emptyData
	file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_imc_pilot6_hc_battleStart" )
	// 6segmentsLeft
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_6segmentsLeft" ]
	currentData.append( "diag_imc_pilot6_hc_lostChicket56" )
	// 5segmentsLeft
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_5segmentsLeft" ]
	currentData.append( "diag_imc_pilot6_hc_lostChicket56" )
	// 4segmentsLeft
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_4segmentsLeft" ]
	currentData.append( "diag_imc_pilot6_hc_lostChicket34" )
	// 3segmentsLeft
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_3segmentsLeft" ]
	currentData.append( "diag_imc_pilot6_hc_lostChicket34" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_imc_pilot6_hc_lostChicket2" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_imc_pilot6_hc_lostChicket1" )
	// death
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_death" ]
	currentData.append( "diag_imc_pilot6_hc_death" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_imc_pilot6_hc_plyrLostChicklet" )
	// coreAbility_mp_titancore_shift_core
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ]
	currentData.append( "diag_imc_pilot6_hc_coreSwordActivate" )
	// coreAbility_mp_titancore_flight_core
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ]
	currentData.append( "diag_imc_pilot6_hc_coreFlightActivate" )
	// coreAbility_mp_titancore_laser_cannon
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ]
	currentData.append( "diag_imc_pilot6_hc_coreLaserActivate" )
	// coreAbility_mp_titancore_flame_wave
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ]
	currentData.append( "diag_imc_pilot6_hc_coreFlameActivate" )
	// coreAbility_mp_titancore_siege_mode
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ]
	currentData.append( "diag_imc_pilot6_hc_coreSmartActivate" )
	// coreAbility_mp_titancore_salvo_core
	currentData = file.bossTitanConvData[ "Generic6" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ]
	currentData.append( "diag_imc_pilot6_hc_coreRocketActivate" )

	////////////////
	/// Generic7 ///
	////////////////
	file.bossTitanConvData[ "Generic7" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_6segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_5segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_4segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_3segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ] <- clone emptyData
	file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_imc_pilot7_hc_battleStart" )
	// 6segmentsLeft
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_6segmentsLeft" ]
	currentData.append( "diag_imc_pilot7_hc_lostChicket56" )
	// 5segmentsLeft
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_5segmentsLeft" ]
	currentData.append( "diag_imc_pilot7_hc_lostChicket56" )
	// 4segmentsLeft
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_4segmentsLeft" ]
	currentData.append( "diag_imc_pilot7_hc_lostChicket34" )
	// 3segmentsLeft
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_3segmentsLeft" ]
	currentData.append( "diag_imc_pilot7_hc_lostChicket34" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_imc_pilot7_hc_lostChicket2" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_imc_pilot7_hc_lostChicket1" )
	// death
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_death" ]
	currentData.append( "diag_imc_pilot7_hc_death" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_imc_pilot7_hc_plyrLostChicklet" )
	// coreAbility_mp_titancore_shift_core
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ]
	currentData.append( "diag_imc_pilot7_hc_coreSwordActivate" )
	// coreAbility_mp_titancore_flight_core
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ]
	currentData.append( "diag_imc_pilot7_hc_coreFlightActivate" )
	// coreAbility_mp_titancore_laser_cannon
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ]
	currentData.append( "diag_imc_pilot7_hc_coreLaserActivate" )
	// coreAbility_mp_titancore_flame_wave
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ]
	currentData.append( "diag_imc_pilot7_hc_coreFlameActivate" )
	// coreAbility_mp_titancore_siege_mode
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ]
	currentData.append( "diag_imc_pilot7_hc_coreSmartActivate" )
	// coreAbility_mp_titancore_salvo_core
	currentData = file.bossTitanConvData[ "Generic7" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ]
	currentData.append( "diag_imc_pilot7_hc_coreRocketActivate" )

	////////////////
	/// Generic8 ///
	////////////////
	file.bossTitanConvData[ "Generic8" ] <- clone emptyTable
	// init data
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_post_intro" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_6segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_5segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_4segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_3segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_2segmentsLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_1segmentLeft" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_death" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_tookPlayerSegment" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ] <- clone emptyData
	file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ] <- clone emptyData
	// append alias
	// post_intro
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_post_intro" ]
	currentData.append( "diag_imc_pilot8_hc_battleStart" )
	// 6segmentsLeft
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_6segmentsLeft" ]
	currentData.append( "diag_imc_pilot8_hc_lostChicket56" )
	// 5segmentsLeft
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_5segmentsLeft" ]
	currentData.append( "diag_imc_pilot8_hc_lostChicket56" )
	// 4segmentsLeft
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_4segmentsLeft" ]
	currentData.append( "diag_imc_pilot8_hc_lostChicket34" )
	// 3segmentsLeft
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_3segmentsLeft" ]
	currentData.append( "diag_imc_pilot8_hc_lostChicket34" )
	// 2segmentsLeft
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_2segmentsLeft" ]
	currentData.append( "diag_imc_pilot8_hc_lostChicket2" )
	// 1segmentLeft
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_1segmentLeft" ]
	currentData.append( "diag_imc_pilot8_hc_lostChicket1" )
	// death
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_death" ]
	currentData.append( "diag_imc_pilot8_hc_death" )
	// tookPlayerSegment
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_tookPlayerSegment" ]
	currentData.append( "diag_imc_pilot8_hc_plyrLostChicklet" )
	// coreAbility_mp_titancore_shift_core
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_shift_core" ]
	currentData.append( "diag_imc_pilot8_hc_coreSwordActivate" )
	// coreAbility_mp_titancore_flight_core
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_flight_core" ]
	currentData.append( "diag_imc_pilot8_hc_coreFlightActivate" )
	// coreAbility_mp_titancore_laser_cannon
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_laser_cannon" ]
	currentData.append( "diag_imc_pilot8_hc_coreLaserActivate" )
	// coreAbility_mp_titancore_flame_wave
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_flame_wave" ]
	currentData.append( "diag_imc_pilot8_hc_coreFlameActivate" )
	// coreAbility_mp_titancore_siege_mode
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_siege_mode" ]
	currentData.append( "diag_imc_pilot8_hc_coreSmartActivate" )
	// coreAbility_mp_titancore_salvo_core
	currentData = file.bossTitanConvData[ "Generic8" ][ "bossTitan_coreAbility_mp_titancore_salvo_core" ]
	currentData.append( "diag_imc_pilot8_hc_coreRocketActivate" )

	#if BOSS_TITAN_LINE_DEBUG_PRINT
		print( "===================================================================" )
		print( "Boss titan conversation init done!" )
		print( "Initialized conversations: " )
		foreach ( string bossName, table< string, array<string> > convTable in file.bossTitanConvData )
		{
			foreach ( string convType, array<string> convAliases in convTable )
			{
				print( "--------------------------------------------------------" )
				print( "Array print: " + string( convAliases ) )
				print( "Boss name: " + bossName )
				print( "Type: " + convType )
				print( "Sound Aliases: " )
				foreach ( string alias in convAliases )
					print( "    " + alias )
				print( "--------------------------------------------------------" )
			}
		}
		print( "===================================================================" )
	#endif // BOSS_TITAN_LINE_DEBUG_PRINT
}

// init player table
void function OnClientConnected( entity player )
{
	MpBossTitanLineReceiver emptyStruct
	file.mpBossTitanLineReceiver[ player ] <- emptyStruct
	file.aliasUsedTimesOnPlayer[ player ] <- {}
	file.lastSaidLineTimeOnPlayer[ player ] <- 0.0
	file.lastSaidLineTimesOnPlayer[ player ] <- {}
	file.usedAliasesOnPlayer[ player ] <- []
}

// conversation currently no support for new added titan. let them use existing ones
void function MpBossTitan_SetConversationNameOverride( entity titan, string nameOverride )
{
	if ( !( titan in file.conversationTitanNameOverride ) ) // unregistered titan!
		return

	file.conversationTitanNameOverride[ titan ] = nameOverride
}

// init table for boss
void function OnBossTitanRegister( entity titan )
{
	//print( "Calling OnBossTitanRegister() callback! in _boss_titan_conversation.gnut" )
	file.conversationTitanNameOverride[ titan ] <- ""
	MpBossTitanLine emptyStruct
	file.mpBossTitanConversation[ titan ] <- emptyStruct
	file.bossNextRandomLineTime[ titan ] <- 0.0
}

void function OnBossTitanDeregister( entity titan )
{
	if ( titan in file.mpBossTitanConversation )
		delete file.mpBossTitanConversation[ titan ]
	if ( titan in file.bossNextRandomLineTime )
		delete file.bossNextRandomLineTime[ titan ]
}

void function MpBossTitan_ConversationAdvance( entity bossTitan )
{
	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return

	MpBossTitan_PlayConversationDefault( bossTitan, "bossTitan_advance" )
}

void function MpBossTitan_ConversationRetreat( entity bossTitan )
{
	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return

	MpBossTitan_PlayConversationDefault( bossTitan, "bossTitan_retreat" )
}

void function MpBossTitan_ConversationPlayerUseCoreAbility( entity player )
{
	entity titan = MpBossTitan_GetNearbyBossForPlayer( player )
	if ( titan == null )
		return

	string conv = "bossTitan_playerUsedCoreAbility"

	MpBossTitan_PlayConversationDefault( titan, conv )
}

void function MpBossTitan_SetTitanEnableCoreConversation( entity titan, bool enable )
{
	if ( !( titan in file.mpBossTitanConversation ) ) // this is not a registered boss?
		return

	file.mpBossTitanConversation[titan].enableCoreConversation = enable
}

void function MpBossTitan_ConversationUseCoreAbility( entity bossTitan )
{
	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return
	// modified setting, we can disable core dialogue for specific titan
	if ( !( bossTitan in file.mpBossTitanConversation ) ) // this is not a registered boss?
		return
	if ( !file.mpBossTitanConversation[bossTitan].enableCoreConversation )
		return

	string conv = "bossTitan_coreAbility"

	if ( MpBossTitan_IsGenericTitan( bossTitan ) )
	{
		entity coreWeapon = bossTitan.GetOffhandWeapon( OFFHAND_EQUIPMENT )
		if ( !IsValid( coreWeapon ) )
			return
		string coreName = coreWeapon.GetWeaponClassName()
		conv = conv + "_" + coreName
	}

	MpBossTitan_PlayConversationDefault( bossTitan, conv, "", true )
}

void function MpBossTitan_ConversationDeath( entity bossTitan, string bossName )
{
	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return

	MpBossTitan_CancelBossConversation( bossTitan )
	MpBossTitan_PlayConversationDefault( bossTitan, "bossTitan_death", "", true )
}

void function MpBossTitan_ConversationDoomed( entity bossTitan )
{
	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return

	MpBossTitan_PlayConversationDefault( bossTitan, "bossTitan_doomed", "", true )
}

// this is unused
void function MpBossTitan_ConversationDamaged( entity bossTitan )
{
	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return

	float amplitude = RandomFloatRange( 1.5, 2.5 )
	float frequency = 20.0
	float duration = RandomFloatRange( 0.2, 0.4 )

	MpBossTitan_PlayConversationDefault( bossTitan, "bossTitan_damage" )
}

void function MpBossTitan_ConversationTookPlayerSegment( entity victimPlayer, int currentSegment )
{
	entity titan = MpBossTitan_GetNearbyBossForPlayer( victimPlayer )
	if ( titan == null )
		return

	string conv = "bossTitan_tookPlayerSegment"

	MpBossTitan_PlayConversationDefault( titan, conv )
}

void function MpBossTitan_ConversationLostSegment( entity bossTitan, int currentSegment )
{
	float amplitude = 2.0
	float frequency = 40.0
	float duration = RandomFloatRange( 1.5, 2.0 )

	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return

	if ( GetDoomedState( bossTitan ) )
		return

	string conv = ""

	if ( MpBossTitan_IsGenericTitan( bossTitan ) )
	{
		int tabs = GetTitanCurrentRegenTab( bossTitan )
		if ( tabs == 1 )
			conv = "bossTitan_1segmentLeft"
		else
			conv = "bossTitan_" + tabs + "segmentsLeft"
	}
	else
	{
		if ( GetHealthFrac( bossTitan ) <= 0.3 )
			conv = "bossTitan_1segmentLeft"
		else if ( GetHealthFrac( bossTitan ) <= 0.6 )
			conv = "bossTitan_2segmentsLeft"
	}

	if ( conv == "" )
		return

	if ( bossTitan.ContextAction_IsMeleeExecution() )
		return

	if ( !IsAlive( bossTitan ) )
		return

	MpBossTitan_PlayConversationDefault( bossTitan, conv )
}

function MpBossTitan_ConversationNoIntro( entity bossTitan )
{
	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return

	if ( IsAlive( bossTitan ) )
		MpBossTitan_PlayConversationDefault( bossTitan, "bossTitan_post_intro" )

	// intro ended, start random line
	MpBossTitan_StartTitanRandomLines( bossTitan )
}

void function MpBossTitan_ConversationPostIntro( entity bossTitan, bool VDUEnabled )
{
	if ( !MpBossTitan_TitanIsBoss( bossTitan ) )
		return

	if ( VDUEnabled )
		MpBossTitan_PlayConversationDefault( bossTitan, "bossTitan_post_intro", "", true )

	// intro ended, start random line
	thread MpBossTitan_StartTitanRandomLines( bossTitan )
}

void function MpBossTitan_StartTitanRandomLines( entity titan )
{
	titan.EndSignal( "OnDeath" )
	titan.EndSignal( "Doomed" )
	titan.EndSignal( "DeregisterBossTitan" ) // deregistering a boss titan will stop it's conversation
	// custom signal
	titan.Signal( "StopBossTitanRandomLines" )
	titan.EndSignal( "StopBossTitanRandomLines" )

	MpBossTitan_DelayNextBossRandomLine( titan ) // initial wait

	while ( IsValid( titan ) )
	{
		if ( file.bossNextRandomLineTime[ titan ] < Time() && IsAlive( titan.GetEnemy() ) )
			MpBossTitan_PlayConversationDefault( titan, "bossTitan_random" )

		wait 0.5
	}
}

void function MpBossTitan_DelayNextBossRandomLine( entity titan )
{
	if ( !( titan in file.bossNextRandomLineTime ) )
		file.bossNextRandomLineTime[ titan ] <- 0.0
	file.bossNextRandomLineTime[ titan ] = Time() + RandomFloatRange( 20, 30 )
}

void function MpBossTitan_StopTitanRandomLines( entity titan )
{
	titan.Signal( "StopBossTitanRandomLines" )
}

void function MpBossTitan_CancelBossConversation( entity boss )
{
	if ( !( boss in file.mpBossTitanConversation ) ) // this is not a registered boss?
		return

	// try to stop dialogue that may playing on a player
	foreach ( entity player, MpBossTitanLineReceiver receiverStruct in file.mpBossTitanLineReceiver )
	{
		if ( !IsValid( player ) ) // player disconnted!
			continue

		entity lastSpeaker = receiverStruct.lastSpeakerTitan
		string lastSoundAlias = receiverStruct.lastPlayedSoundAlias
		if ( lastSpeaker == boss && lastSoundAlias != "" )
			StopSoundOnEntity( player, lastSoundAlias ) // stop last played sound alias
	}

	boss.Signal( "CancelBossConversation" )
}

void function MpBossTitan_SetTitanConversationStyle( entity titan, int newStyle )
{
	if ( !( titan in file.mpBossTitanConversation ) ) // this is not a registered boss?
		return

	file.mpBossTitanConversation[titan].conversationStyle = newStyle
}

void function MpBossTitan_PlayConversationDefault( entity boss, string conv, string bossNameOverride = "", bool forceLine = false )
{
	if ( !( boss in file.mpBossTitanConversation ) ) // this is not a registered boss?
		return

	int conversationStyle = file.mpBossTitanConversation[boss].conversationStyle
	switch ( conversationStyle )
	{
		case eBossTitanConvStyle.DISABLED:
			break

		case eBossTitanConvStyle.PLAY_TO_TARGET:
			MpBossTitan_PlayConversationToTarget( boss, conv, bossNameOverride, forceLine )
			break
		case eBossTitanConvStyle.PLAY_TO_ALL:
			MpBossTitan_PlayConversationToAll( boss, conv, bossNameOverride, forceLine )
			break
	}
}

void function MpBossTitan_PlayConversationToTarget( entity boss, string conv, string bossNameOverride = "", bool forceLine = false )
{
	if ( !( boss in file.mpBossTitanConversation ) ) // this is not a registered boss?
		return

	entity player
	entity enemy = boss.GetEnemy()
	if ( IsValid( enemy ) )
	{
		if ( enemy.IsPlayer() )
			player = enemy
		else if ( IsValid( GetPetTitanOwner( enemy ) ) )
			player = GetPetTitanOwner( enemy )
	}

	if ( IsValid( player ) )
		MpBossTitan_TryPlayConversationToPlayer( player, boss, conv, bossNameOverride, forceLine )
}

void function MpBossTitan_PlayConversationToAll( entity boss, string conv, string bossNameOverride = "", bool forceLine = false )
{
	if ( !( boss in file.mpBossTitanConversation ) ) // this is not a registered boss?
		return

	foreach ( entity player in GetPlayerArray() )
		MpBossTitan_TryPlayConversationToPlayer( player, boss, conv, bossNameOverride, forceLine )
}

//  __  __    _    ___ _   _     _   _ _____ ___ _     ___ _______   __
// |  \/  |  / \  |_ _| \ | |   | | | |_   _|_ _| |   |_ _|_   _\ \ / /
// | |\/| | / _ \  | ||  \| |   | | | | | |  | || |    | |  | |  \ V / 
// | |  | |/ ___ \ | || |\  |   | |_| | | |  | || |___ | |  | |   | |  
// |_|  |_/_/   \_\___|_| \_|    \___/  |_| |___|_____|___| |_|   |_|  

bool function MpBossTitan_TryPlayConversationToPlayer( entity player, entity boss, string conv, string bossNameOverride = "", bool forceLine = false )
{
	if ( !( boss in file.mpBossTitanConversation ) ) // this is not a registered boss?
		return false

	string name = bossNameOverride
	float timeout = BOSS_TITAN_LINE_TIMEOUT
	float globalTimeout = timeout

	if ( bossNameOverride == "" ) // empty override name
	{
		name = boss.ai.bossCharacterName
		// in-file override name
		if ( boss in file.conversationTitanNameOverride && file.conversationTitanNameOverride[ boss ] != "" )
			name = file.conversationTitanNameOverride[ boss ]

		if ( !MpBossTitan_IsGenericTitan( boss ) )
		{
			if ( conv == "bossTitan_2segmentsLeft" || conv == "bossTitan_1segmentLeft" ) // hack since bosses only have 2 lines
				timeout *= 5
		}
	}

	// cooldown think
	if ( conv in file.lastSaidLineTimesOnPlayer[player] )
	{
		if ( Time() - file.lastSaidLineTimesOnPlayer[player][conv] < timeout && !forceLine )
			return false
	}
	else
		file.lastSaidLineTimesOnPlayer[player][conv] <- Time()

	if ( !forceLine && Time() - file.lastSaidLineTimeOnPlayer[player] < globalTimeout * 0.75 )
		return false

	file.lastSaidLineTimesOnPlayer[player][conv] = Time()
	file.lastSaidLineTimeOnPlayer[player] = Time()

	#if BOSS_TITAN_LINE_DEBUG_PRINT
		printt( "===========================================" )
		printt( "PlayBossTitanLine:" )
		printt( "conv: " + conv )
		printt( "name: " + name )
		string convName = conv + "_" + name.tolower()
		printt( "convName: " + convName )
		printt( "target player: " + string( player ) )
		printt( "===========================================" )
	#endif

	// find alias from bossName and conv
	string soundAlias = ""
	if ( name in file.bossTitanConvData )
	{
		if ( conv in file.bossTitanConvData[name] )
			soundAlias = GetBestAliasForPlayer( file.bossTitanConvData[name][conv], player )
	}
	if ( soundAlias == "" ) // can't find sound!
	{
		#if BOSS_TITAN_LINE_DEBUG_PRINT
			print( "Can't find sound alias!" )
		#endif
		return false
	}

	#if BOSS_TITAN_LINE_DEBUG_PRINT
		print( "Actual sound alias: " + soundAlias )
	#endif

	// ASH HACK:
	if ( soundAlias == "diag_sp_BossVdu_BM112_03_01_imc_ash" ) // "Impressive...surprisingly impressive."
	{
		// so she doesn't say "Very disappointing. I expected so much more of you." right after saying "Impressive...surprisingly impressive."
		file.usedAliasesOnPlayer[player].append( "diag_sp_BossVdu_BM112_27_01_imc_ash" )
	}

	// if player has last speaker valid, stop last sound
	entity lastSpeaker = file.mpBossTitanLineReceiver[player].lastSpeakerTitan
	if ( IsValid( lastSpeaker ) )
	{
		string lastSoundAlias = file.mpBossTitanLineReceiver[player].lastPlayedSoundAlias
		if ( lastSoundAlias != "" )
			StopSoundOnEntity( player, lastSoundAlias ) // stop last played sound alias
	}

	EmitSoundOnEntityOnlyToPlayer( player, player, soundAlias ) // emit sound on player, so we can stop last sound if needed
	file.mpBossTitanConversation[boss].lastPlayedSoundAlias = soundAlias // update last played sound alias
	// update last speaker
	file.mpBossTitanLineReceiver[player].lastSpeakerTitan = boss
	file.mpBossTitanLineReceiver[player].lastPlayedSoundAlias = soundAlias
	// update alias used time
	if ( !( soundAlias in file.aliasUsedTimesOnPlayer[player] ) )
		file.aliasUsedTimesOnPlayer[player][soundAlias] <- Time()
	else
		file.aliasUsedTimesOnPlayer[player][soundAlias] = Time()

	// if conversation succeeded, we add debounce for next random line
	MpBossTitan_DelayNextBossRandomLine( boss )
	return true
}

// from sh_ai_boss_titan.gnut
// remove struct. using array<string> is enough for mp
//string function GetBestAliasForPlayer( BossTitanConversation data, entity player )
string function GetBestAliasForPlayer( array<string> soundAliases, entity player )
{
	// remove struct. using array<string> is enough for mp
	//string alias = GetFreshAliasForPlayer( data, player )
	string alias = GetFreshAliasForPlayer( soundAliases, player )
	if ( alias == "" )
	{
		float longestTime = 0.0
		// remove struct. using array<string> is enough for mp
		//array<string> aliases = clone data.soundAliases
		array<string> aliases = clone soundAliases
		aliases.randomize()
		foreach ( a in aliases )
		{
			if (!( a in file.aliasUsedTimesOnPlayer[player] ))
			{
				return a
			}
			else
			{
				float lastUsedDelay = Time() - file.aliasUsedTimesOnPlayer[player][a]
				if ( lastUsedDelay > longestTime )
				{
					longestTime = lastUsedDelay
					alias = a
				}
			}
		}
	}
	else
	{
		file.usedAliasesOnPlayer[player].append( alias )
	}

	return alias
}

// remove struct. using array<string> is enough for mp
//string function GetFreshAliasForPlayer( BossTitanConversation data, entity player )
string function GetFreshAliasForPlayer( array<string> soundAliases, entity player )
{
	// remove struct. using array<string> is enough for mp
	//foreach ( alias in data.soundAliases )
	foreach ( string alias in soundAliases )
	{
		#if BOSS_TITAN_LINE_DEBUG_PRINT
			print( "Current finding alias: " + alias )
		#endif
		if ( !file.usedAliasesOnPlayer[player].contains(alias) )
		{
			#if BOSS_TITAN_LINE_DEBUG_PRINT
				print( "Alias " + alias + " is good enough to use!" )
			#endif
			return alias
		}
	}

	return ""
}